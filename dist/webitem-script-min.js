// webitem.js Library to simplify creating HTML5 Custom Elements
// https://github.com/ahabra/webitem
// Copyright 2021 (C) Abdul Habra
// Apache License Version 2.0


var webitem=(()=>{var d=Object.defineProperty,j=t=>d(t,"__esModule",{value:!0}),v=(t,e)=>{j(t);for(var n in e)d(t,n,{get:e[n],enumerable:!0})},k={};v(k,{defineElement:()=>O});function h(t){return m(t,"String")}function g(t){return m(t,"Function")}function m(t,e){return Object.prototype.toString.call(t)===`[object ${e}]`}function p(t,e){if(!t||!e)return;if(Array.isArray(t)){t.forEach((n,r)=>{e(r,n)});return}Object.entries(t).forEach(n=>e(n[0],n[1]))}function y(t,e,n){if(n)return t.startsWith(e);let r=t.substring(0,e.length).toLowerCase();return e.toLowerCase()===r}function a(t){return $(t)?"":(h(t)||(t=String(t)),t.trim(t))}function $(t){return t==null||t===""}function b(t,e){return e=e||document,Array.from(e.querySelectorAll(":scope "+t))}function E(t){if(!t)return[];if(t=t.trim(),t.length===0)return[];let e=document.createElement("template");return e.innerHTML=t,Array.prototype.slice.call(e.content.childNodes)}function A({name:t,attributes:e,content:n}){if(!t)return null;let r=[];p(e,(s,u)=>{r.push(`${s}="${u}"`)});let i=r.length>0?" ":"",o=r.join(" ");return`<${t}${i}${o}>${n}</${t}>`}function f({obj:t,prop:e,sel:n,attr:r,root:i}){P({prop:e,sel:n}),t=t||{};let o=t.hasOwnProperty(e)?t[e]:void 0;i=i||document;let s={get:()=>L(i,n,r),set:u=>N(i,n,u,r),configurable:!0,enumerable:!0};return Object.defineProperty(t,e,s),o!==void 0&&(console.info(`Property '${e}' already exists in object. Will override previous definition but retain old value of ${o}.`),t[e]=o),t}var c=t=>t.type==="checkbox",l=t=>t.type==="radio",S=t=>t.tagName.toLowerCase()==="select",x=t=>"value"in t,U=t=>new Set(Array.isArray(t)?t:[t]);function L(t,e,n){let r=w(t,e);if(r.length===0)return null;let i=r[0];if(n)return i.getAttribute(n);if(!x(i))return i.innerHTML;if(c(i))return r.filter(o=>c(o)&&o.checked).map(o=>o.value==="on"?o.name:o.value);if(S(i)){let o=[...i.querySelectorAll("option")];return o.filter(s=>s.selected).map(s=>s.value)}return l(i)&&(i=r.filter(l).find(o=>o.checked)),i.value}function N(t,e,n,r){let i=w(t,e);if(i.length===0)return;let o=i[0];if(c(o)){let s=U(n);i.filter(c).forEach(u=>u.checked=s.has(u.value)||s.has(u.name));return}if(S(o)){let s=U(n);o.querySelectorAll("option").forEach(u=>u.selected=s.has(u.value));return}if(l(o)){i.filter(l).forEach(s=>s.checked=s.value===n);return}i.forEach(s=>T(s,n,r))}function T(t,e,n){n?t.setAttribute(n,e):x(t)?t.value=e:t.innerHTML=e}function w(t,e){let n=t.querySelectorAll(e);return n.length===0&&console.warn(`No elements found matching selector ${e}`),[...n]}function P({prop:t,sel:e}){if(typeof t!="string"||t.length===0)throw"'prop' argument must be a String defining the name a property.";if(typeof e!="string"||e.length===0)throw"'sel' argument must be a String defining a selector."}function O({nameWithDash:t,html:e,css:n,display:r,propertyList:i,actionList:o,eventHandlerList:s}){let u=class extends HTMLElement{constructor(){super();q(this,e,n,r),this.properties=C(this,i),this.actions=D(this,o),H(this,s)}};customElements.define(t,u)}function C(t,e){let n={};return V(e)&&e.forEach(r=>M(n,r)),n}function M(t,e){e.sel&&f({obj:t,prop:e.name,sel:e.sel,attr:e.attr,root:root.shadowRoot}),t[e.name]=e.value}function V(t){if(!t)return!1;if(!Array.isArray(t))throw"propertyList must be an array of {name, value, [sel], [attr]} objects";return!0}function D(t,e){let n={};return e&&e.forEach(r=>{r.name&&r.action&&(n[r.name]=r.action.bind(t))}),n}function H(t,e){if(!e)return;if(!Array.isArray(e))throw"eventHandlerList must be an array of {sel, eventName, listener} objects";e.forEach(n=>{let r=b(n.sel,t.shadowRoot);r.forEach(i=>{i.addEventListener(n.eventName,o=>{n.listener(o,t)})})})}function q(t,e,n,r){e=W(t,e);let i=t.attachShadow({mode:"open"}),o=E(F(n,r)+e);i.append(...o)}function W(t,e){return g(e)?e(t):e}function F(t,e){return R(e)+I(t)}function I(t){return t=a(t),t.length===0?"":(y(t,"<style>",!1)||(t=A({name:"style",content:t})),t)}function R(t){return t=a(t),t.length===0?"":`
  <style>
    :host { display: ${t};}
    :host([hidden]) {display: none;}
  </style>
  `}return k;})();
