// webitem.js Library to simplify creating HTML5 Custom Elements
// https://github.com/ahabra/webitem
// Copyright 2021 (C) Abdul Habra
// Apache License Version 2.0


var webitem=(()=>{var d=Object.defineProperty,v=t=>d(t,"__esModule",{value:!0}),$=(t,e)=>{v(t);for(var n in e)d(t,n,{get:e[n],enumerable:!0})},C={};$(C,{defineElement:()=>O,defineProperty:()=>j});function h(t){return m(t,"String")}function g(t){return m(t,"Function")}function m(t,e){return Object.prototype.toString.call(t)===`[object ${e}]`}function p(t,e){if(!t||!e)return;if(Array.isArray(t)){t.forEach((n,r)=>{e(r,n)});return}Object.entries(t).forEach(n=>e(n[0],n[1]))}function y(t,e,n){if(n)return t.startsWith(e);let r=t.substring(0,e.length).toLowerCase();return e.toLowerCase()===r}function a(t){return L(t)?"":(h(t)||(t=String(t)),t.trim(t))}function L(t){return t==null||t===""}function b(t,e){return e=e||document,Array.from(e.querySelectorAll(":scope "+t))}function E(t){if(!t)return[];if(t=t.trim(),t.length===0)return[];let e=document.createElement("template");return e.innerHTML=t,Array.prototype.slice.call(e.content.childNodes)}function x({name:t,attributes:e,content:n}){if(!t)return null;let r=[];p(e,(s,u)=>{r.push(`${s}="${u}"`)});let i=r.length>0?" ":"",o=r.join(" ");return`<${t}${i}${o}>${n}</${t}>`}function f({obj:t,prop:e,sel:n,attr:r,root:i}){T({prop:e,sel:n}),t=t||{};let o=t.hasOwnProperty(e)?t[e]:void 0;i=i||document;let s={get:()=>N(i,n,r),set:u=>P(i,n,u,r),configurable:!0,enumerable:!0};return Object.defineProperty(t,e,s),o!==void 0&&(console.info(`Property '${e}' already exists in object. Will override previous definition but retain old value of ${o}.`),t[e]=o),t}var l=t=>t.type==="checkbox",c=t=>t.type==="radio",A=t=>t.tagName.toLowerCase()==="select",S=t=>"value"in t,U=t=>new Set(Array.isArray(t)?t:[t]);function N(t,e,n){let r=w(t,e);if(r.length===0)return null;let i=r[0];if(n)return i.getAttribute(n);if(!S(i))return i.innerHTML;if(l(i))return r.filter(o=>l(o)&&o.checked).map(o=>o.value==="on"?o.name:o.value);if(A(i)){let o=[...i.querySelectorAll("option")];return o.filter(s=>s.selected).map(s=>s.value)}return c(i)&&(i=r.filter(c).find(o=>o.checked)),i.value}function P(t,e,n,r){let i=w(t,e);if(i.length===0)return;let o=i[0];if(l(o)){let s=U(n);i.filter(l).forEach(u=>u.checked=s.has(u.value)||s.has(u.name));return}if(A(o)){let s=U(n);o.querySelectorAll("option").forEach(u=>u.selected=s.has(u.value));return}if(c(o)){i.filter(c).forEach(s=>s.checked=s.value===n);return}i.forEach(s=>k(s,n,r))}function k(t,e,n){n?t.setAttribute(n,e):S(t)?t.value=e:t.innerHTML=e}function w(t,e){let n=t.querySelectorAll(e);return n.length===0&&console.warn(`No elements found matching selector ${e}`),[...n]}function T({prop:t,sel:e}){if(typeof t!="string"||t.length===0)throw"'prop' argument must be a String defining the name a property.";if(typeof e!="string"||e.length===0)throw"'sel' argument must be a String defining a selector."}function O({nameWithDash:t,html:e,css:n,display:r,propertyList:i,eventHandlerList:o}){let s=class extends HTMLElement{constructor(){super();q(this,e,n,r),this.properties=D(this,i),H(this,o)}};customElements.define(t,s)}function j(t,e,n,r){return{name:t,value:e,sel:n,attr:r}}function D(t,e){let n={};return M(e)&&e.forEach(r=>{r.sel&&f({obj:n,prop:r.name,sel:r.sel,attr:r.attr,root:t.shadowRoot}),n[r.name]=r.value}),n}function M(t){if(!t)return!1;if(!Array.isArray(t))throw"propertyList must be an array of {name, value, [sel], [attr]} objects";return!0}function H(t,e){if(!e)return;if(!Array.isArray(e))throw"eventHandlerList must be an array of {sel, eventName, listener} objects";e.forEach(n=>{let r=b(n.sel,t.shadowRoot);r.forEach(i=>{i.addEventListener(n.eventName,o=>{n.listener(o,t)})})})}function q(t,e,n,r){e=V(t,e);let i=t.attachShadow({mode:"open"}),o=E(W(n,r)+e);i.append(...o)}function V(t,e){return g(e)?e(t):e}function W(t,e){return I(e)+F(t)}function F(t){return t=a(t),t.length===0?"":(y(t,"<style>",!1)||(t=x({name:"style",content:t})),t)}function I(t){return t=a(t),t.length===0?"":`
  <style>
    :host { display: ${t};}
    :host([hidden]) {display: none;}
  </style>
  `}return C;})();
